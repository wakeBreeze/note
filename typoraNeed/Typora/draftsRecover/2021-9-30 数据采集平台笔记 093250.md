数据采集平台：sqybAdmin/Yinhai123



#### 打包

- 记得更改jdbc中的地址 247

- 以及DrgConfig中的

- ```java
  /**
       * 是否启用远程接口
       */
      public static boolean IS_RUN_WEBSERVICE = true;
  ```

  



#### TODO

ValidateDataServiceImpl	127行

preValidateData(KEU5 keu5)

方法需要参数：baa001,aaa027,ake554,akb020,bke139





```sql
-- 开始
select * from kec2
order by aae036 desc

-- 结束
select * from kes5
order by aae036 desc
```



appcode状态信息在Constants表中



```sql
-- 查询平台第三方外界系统中医疗机构代码对应信息
-- 用于查看<head>头信息是否对应正确
select * from wske01
where wsakf020 = '1165'
```



aa10_ver:国家码表

aa10_config:需要校验的码表



#### 数据采集平台主要流程

主要验证内容：

中西医首页：kec1,kec2

医师医嘱，检验，检查，手术，出院小结：ket5~ket9,keu1~keu3

流程：

上传

↓

解析报文（xsd格式）

↓

将报文中的数据存到对应表中（也就是上面的**主要验证内容**）

↓

生成数据采集批次记录存入keu5中

↓

将bke139存入队列（全局）

↓

线程池执行校验（队列中取出bke139）

↓

根据bke139查询keu5之前插入的信息

↓

取出kec1,kec2病案数据进行校验

↓

逻辑校验、完整性校验（错误日志存入kea21），扣分（kes5）





mzys，szdm：可以填医生或护士代码



D：kzrdm（科主任代码）,zrysdm（主任医师代码）,zzysgjdm（主治医师国家代码）,zyysdm（住院医师代码）,zkysdm（质控医师代码）



N：zrhsdm（责任护士代码）,zkhsdm（质控护士代码）



D|N：szdm1-7（术者代码1-7）,mzys代码1-7（麻醉医师代码1-7）







```java
select * from kec2 order by aae036 desc;
select * from keu5 order by aae036 desc;
select * from kes5 order by aae036 desc;
-- truncate table kes5;

```

select * from kec1 order by aae036 desc;
select * from kec2 order by aae036 desc;
select * from keu5 order by aae036 desc;
select * from kes5 order by aae036 desc;
-- truncate table kes5;

select baz506,akc190,bah from (
    select baz506,akc190, rank() over(partition by bah,zycs,rysj order by baz506 desc) as row_index,bah from KEC2
    where aaa131 = 0 and akb020 = '1940'
    )
    where row_index>1;
    
    select baz506,akb020,akc190,bah as 病案号,aaa131 as 撤销标志,rysj as 入院时间,cysj as 出院时间,aae036 as 上传时间 from kec2 where bah = '202101833';
    
    select * from kec2 where akc190 = '310005577286'
    
    select * from wske01 where wsake119 = '1830';
    
    select * from keu1;
    select * from ket6;
    
    select
        c.akc190
      from kec2 c inner join kea5@drgsplatform_js d
      on c.akc190 = d.akc190 and c.akb020 = d.akb020 and d.aaa131 = '0'
      where c.aaa131 = '0'
      
      select * from kea5
      
      select akc190,aaa131,bke701 from kec2 where akc190 = '310007079740';
      select akc190,aaa131 from kec2 where akc190 = '310005577286'





select * from kec2 where akb020 = '1830';

select * from wske54 order by wsaae036 desc;
select * from wsaa11 order by wsaae036 desc;

select * from keu5 where bke139 = '33090012021092709350814700';
